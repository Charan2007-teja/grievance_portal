{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="fw-bold text-primary">
        HOD Dashboard â€” {{ current_user.department }}
    </h2>

    <a href="{{ url_for('auth.profile_page') }}"
       class="btn btn-outline-primary">
        Profile
    </a>
</div>

<hr>

<!-- ================= PENDING STUDENTS ================= -->
<h4 class="fw-semibold mt-4">Pending Student Approvals</h4>

<div class="card p-3 mb-4 shadow-sm">
<table class="table table-bordered align-middle">
<thead>
<tr>
<th>Name</th><th>PIN</th><th>Email</th><th>Approve</th><th>Decline</th>
</tr>
</thead>
<tbody>
{% for s in pending_students %}
<tr>
<td>{{ s.name }}</td>
<td>{{ s.pin }}</td>
<td>{{ s.email }}</td>
<td>
<a href="{{ url_for('hod.approve_student', student_id=s.id) }}"
   class="btn btn-success btn-sm">Approve</a>
</td>
<td>
<a href="{{ url_for('hod.decline_student', student_id=s.id) }}"
   class="btn btn-danger btn-sm"
   onclick="return confirm('Are you sure?');">Decline</a>
</td>
</tr>
{% else %}
<tr><td colspan="5" class="text-center text-muted">No pending students</td></tr>
{% endfor %}
</tbody>
</table>
</div>

<!-- ================= COMPLAINTS ================= -->
<h4 class="fw-semibold mt-4">Complaints Assigned to HOD</h4>

<div class="card p-3 shadow-sm">
<table class="table table-bordered align-middle">
<thead>
<tr>
<th>Title</th>
<th>Category</th>
<th>Student</th>
<th>Status</th>
<th>Submitted</th>
<th>Actions</th>
</tr>
</thead>
<tbody>

{% for c in complaints %}
<tr>
<td>{{ c.title }}</td>
<td>{{ c.category.replace('_',' ') | title }}</td>
<td>
{{ c.student.name }}<br>
<small class="text-muted">PIN: {{ c.student.pin }}</small>
</td>
<td>
<span class="badge bg-info">{{ c.status }}</span>
</td>
<td>{{ c.created_at.strftime('%d %b %Y %I:%M %p') }}</td>
<td class="d-flex gap-2">


<a href="{{ url_for('hod.view_complaint', cid=c.id) }}"
   class="btn btn-outline-primary btn-sm">View</a>

{% if c.status == "Pending" %}
<a href="{{ url_for('hod.respond', complaint_id=c.id) }}"
   class="btn btn-primary btn-sm">Respond</a>
{% elif c.status == "In Progress" %}
<a href="{{ url_for('hod.resolve_complaint', complaint_id=c.id) }}"
   class="btn btn-warning btn-sm">Resolve</a>
{% else %}
<button class="btn btn-secondary btn-sm" disabled>Completed</button>
{% endif %}

</td>
</tr>
{% else %}
<tr>
<td colspan="6" class="text-center text-muted">
No complaints found
</td>
</tr>
{% endfor %}

</tbody>
</table>
</div>

{% endblock %}