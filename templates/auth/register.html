{% extends "base.html" %}
{% block content %}

<!-- HEADER -->
<div class="bg-white border rounded shadow-sm p-3 mb-4 text-center">
    <img src="{{ url_for('static', filename='images/sdptlogo.jpg') }}" height="90">
    <h4 class="fw-bold mt-2 mb-0">Government Polytechnic SDPT</h4>
    <small class="text-muted">(Approved by AICTE, Affiliated to NBA)</small>
</div>

<!-- REGISTRATION FORM -->
<div class="container" style="max-width: 650px;">
    <div class="card shadow-sm border-0">
        <div class="card-body p-4">

            <h4 class="text-center fw-semibold mb-3">Student Registration</h4>

            <form method="post" onsubmit="return validateForm();">

                <!-- Full Name -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Full Name</label>
                    <input type="text" name="name" id="name" class="form-control" required>
                    <small class="text-danger d-none" id="nameError">Enter a valid name (letters only)</small>
                </div>

                <!-- Email -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Email</label>
                    <input type="email" name="email" id="email" class="form-control" required>
                    <small class="text-danger d-none" id="emailError">Enter a valid email address</small>
                </div>

                <!-- Student PIN -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">
                        Student PIN
                        <span class="text-muted small">(Format: YY189-CS-001)</span>
                    </label>
                    <input type="text" name="pin" id="pin" class="form-control" required>
                    <small class="text-danger d-none" id="pinError"></small>
                    <small class="text-success d-none" id="pinSuccess"></small>
                    <small class="text-info d-none" id="deptInfo">Department auto-selected.</small>
                </div>

                <!-- Department -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Department</label>
                    <select name="department" id="department" class="form-select" required>
                        <option value="">Select Department</option>
                        <option value="CSE">ðŸ’» CSE â€” Computer Science</option>
                        <option value="ECE">âš¡ ECE â€” Electronics</option>
                    </select>
                </div>

                <!-- Password -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Create Password</label>
                    <div class="input-group">
                        <input type="password" name="password" id="password" class="form-control" required>
                        <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('password')">Show</button>
                    </div>
                    <div class="mt-2">
                        <small id="strengthText" class="fw-semibold"></small>
                        <div class="progress mt-1" style="height: 5px;">
                            <div id="strengthBar" class="progress-bar"></div>
                        </div>
                    </div>
                </div>

                <!-- Confirm Password -->
                <div class="mb-3">
                    <label class="form-label fw-semibold">Confirm Password</label>
                    <div class="input-group">
                        <input type="password" id="confirmPassword" class="form-control" required>
                        <button type="button" class="btn btn-outline-secondary" onclick="togglePassword('confirmPassword')">Show</button>
                    </div>
                    <small class="text-danger d-none" id="confirmError">Passwords do not match</small>
                </div>

                <!-- TERMS -->
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="termsCheck" required>
                    <label class="form-check-label">
                        I agree to the <a href="#" class="text-decoration-none">Terms & Privacy Policy</a>
                    </label>
                </div>

                <!-- Submit Button -->
                <div class="d-grid">
                    <button class="btn btn-primary fw-semibold py-2">Register</button>
                </div>

            </form>

        </div>
    </div>
</div>



<!-- ====================== JAVASCRIPT ====================== -->
<script>

/* ========================== SHOW/HIDE PASSWORD ========================== */
function togglePassword(id) {
    const input = document.getElementById(id);
    input.type = input.type === "password" ? "text" : "password";
}


/* ========================== PASSWORD STRENGTH METER ========================== */
document.getElementById("password").addEventListener("input", function () {
    const pass = this.value;
    const bar = document.getElementById("strengthBar");
    const text = document.getElementById("strengthText");

    let strength = 0;
    if (pass.length >= 6) strength++;
    if (/[A-Z]/.test(pass)) strength++;
    if (/[0-9]/.test(pass)) strength++;
    if (/[@$!%*?&]/.test(pass)) strength++;

    if (strength === 1) {
        bar.style.width = "25%"; bar.className = "progress-bar bg-danger";
        text.textContent = "Weak"; text.style.color = "#dc2626";
    } else if (strength === 2) {
        bar.style.width = "50%"; bar.className = "progress-bar bg-warning";
        text.textContent = "Medium"; text.style.color = "#f59e0b";
    } else if (strength === 3) {
        bar.style.width = "75%"; bar.className = "progress-bar bg-info";
        text.textContent = "Good"; text.style.color = "#0d6efd";
    } else if (strength === 4) {
        bar.style.width = "100%"; bar.className = "progress-bar bg-success";
        text.textContent = "Strong"; text.style.color = "#16a34a";
    } else {
        bar.style.width = "0%"; text.textContent = "";
    }
});


/* ========================== PIN VALIDATION (YEAR + FORMAT) ========================== */
document.getElementById("pin").addEventListener("input", function () {

    const pin = this.value.toUpperCase();
    this.value = pin;

    const pinError = document.getElementById("pinError");
    const pinSuccess = document.getElementById("pinSuccess");
    const deptSelect = document.getElementById("department");
    const deptInfo = document.getElementById("deptInfo");

    const pattern = /^[0-9]{2}189-(CS|EC)-[0-9]{3}$/;

    function showError(msg) {
        pinError.textContent = msg;
        pinError.classList.remove("d-none");
        pinSuccess.classList.add("d-none");
        deptInfo.classList.add("d-none");
    }

    if (!pattern.test(pin)) {
        showError("Format must be: YY189-CS-001");
        return;
    }

    // Extract year
    const yy = parseInt(pin.substring(0, 2));
    const fullYear = 2000 + yy; // 23 â†’ 2023
    const currentYear = new Date().getFullYear();

    if (fullYear > currentYear) {
        showError(`Year ${fullYear} is not valid yet`);
        return;
    }

    if (fullYear < 2010) {
        showError(`Year ${fullYear} is too old`);
        return;
    }

    pinError.classList.add("d-none");

    pinSuccess.textContent = `Valid PIN â€” Batch ${fullYear}`;
    pinSuccess.classList.remove("d-none");

    // Auto select Department
    const dept = pin.split("-")[1];
    deptSelect.value = dept === "CS" ? "CSE" : "ECE";
    deptInfo.classList.remove("d-none");

});



/* ========================== FINAL FORM VALIDATION ========================== */
function validateForm() {
    let valid = true;

    // NAME
    if (!/^[A-Za-z ]+$/.test(name.value)) {
        nameError.classList.remove("d-none"); valid = false;
    } else nameError.classList.add("d-none");

    // EMAIL
    if (!email.value.includes("@")) {
        emailError.classList.remove("d-none"); valid = false;
    } else emailError.classList.add("d-none");

    // CONFIRM PASSWORD
    if (password.value !== confirmPassword.value) {
        confirmError.classList.remove("d-none"); valid = false;
    } else confirmError.classList.add("d-none");

    // If invalid â†’ stop
    return valid;
}

</script>

{% endblock %}
